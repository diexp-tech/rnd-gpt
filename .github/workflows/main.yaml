name: Main CI

on:
  push:
    branches:
      - "master"

jobs:
  test:
    name: Test
    uses: ./packages/server/.github/workflows/test.yaml@v1

  build:
    name: Build
    uses: ./packages/server/.github/workflows/build.yaml@v1
    secrets: inherit
    needs: test

  deploy:
    name: Deploy
    uses: ./packages/server/.github/workflows/fly-io.yaml@v1
    secrets: inherit
    needs: build


